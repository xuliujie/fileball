var messageWrapper=null,siteSmileys=[[":ez:",'<img src="/static/img/chat/ez.png" />'],[":facepalm:",'<img src="/static/img/chat/facepalm.png" />'],[":fail:",'<img src="/static/img/chat/fail.png" />'],[":gl:",'<img src="/static/img/chat/gl.png" />'],[":illuminati:",'<img src="/static/img/chat/illuminati.png" />'],[":kappa:",'<img src="/static/img/chat/kappa.png" />'],[":luck:",'<img src="/static/img/chat/luck.png" />'],[":pepe:",'<img src="/static/img/chat/pepe.png" />'],[":rip:",'<img src="/static/img/chat/rip.png" />'],
[":salty:",'<img src="/static/img/chat/salty.png" />'],[":sniped:",'<img src="/static/img/chat/sniped.png" />']],chatRulesModalData={id:"chatRulesModal",isFull:!1,title:"Chat Rules",content_com:"chat-rules",modal_icon:"handel-icon",text_save:"",text_close:"Okay"};function reformatSmiley(a){for(var b=0;b<siteSmileys.length;b++)a=a.replace(siteSmileys[b][0],siteSmileys[b][1]);return a}Vue.component("chat-rules",{template:"#chat-rules-template"});
Vue.component("chat-item",{template:"#chat-template",delimiters:["^{","}"],props:["item"],mounted:function(){var a=this.$refs.chat_msg_content;a.innerHTML=reformatSmiley(a.innerText)}});Vue.component("handel-icon",{template:"#handel-icon-template"});
$(function(){messageWrapper=new Vue({el:"#messages-wrapper",delimiters:["^{","}"],data:{items:[]},methods:{addMessage:function(a){12<=this.items.length&&this.items.shift();this.items.push(a);Vue.nextTick(function(){$("#messages-wrapper").scrollTop(830).perfectScrollbar("update")})}}});$("#mChatRules").click(function(){modalArea.modalData=chatRulesModalData;Vue.nextTick(function(){$("#chatRulesModal").modal("show")})});$(".chat-smile").click(function(){var a=$(this).data("code"),b=$("#chat_msg");b.val(b.val()+
a)});$("#messages-wrapper").perfectScrollbar()});var depositBus=new Vue;
Vue.component("inv-deposit",{template:"#inv-deposit-template",delimiters:["^{","}"],props:["item","extra"],data:function(){return{selectedTeam:this.item.user.join_team?this.item.user.join_team:0,inventories:[],inventoriesShow:[],selectedItems:[],selectedAmount:0,couldRefresh:!0,refreshTimer:null,gid:this.item.gid,inventoryLoading:!0,inventoryLoaded:!1,inventoryMakeOffer:!1,depositLoading:!1,intervalID:null,showTeam:this.extra.showTeam,curPage:0,noPrePage:!0,noNextPage:!0}},created:function(){var a=
this;a.refreshTimer=new Timer;a.refreshTimer.addEventListener("secondsUpdated",function(b){b=a.refreshTimer.getTimeValues();b=60*b.minutes+b.seconds;$("#invTimer").text(b)});a.refreshTimer.addEventListener("targetAchieved",function(b){a.couldRefresh=!0;$("#invRefresh").prop("disabled",!1)})},mounted:function(){this.initShow();this.refreshInventory()},destroyed:function(){this.refreshTimer.stop();this.intervalID&&clearTimeout(this.intervalID)},methods:{initShow:function(){this.tradeNo=null;this.depositLoading=
this.inventoryLoaded=!1;this.inventoryLoading=!0;this.inventoryMakeOffer=!1;this.intervalID=null},selectTeam:function(a){this.selectedTeam=a=a.currentTarget.dataset.team;$('div[class*="row-team"] img').removeClass("selected");$('div[class*="row-team"] img[data-team="'+a+'"]').addClass("selected")},showName:function(a){$("div[data-itemid="+a[0].currentTarget.dataset.itemid+"]").removeClass("hide-name")},hideName:function(a){$("div[data-itemid="+a[0].currentTarget.dataset.itemid+"]").addClass("hide-name")},
clickItem:function(a){a=a[0];this.selectItem(a.currentTarget.dataset.itemid,a.currentTarget.dataset.amount)},selectItem:function(a,b){var c=$("div[data-itemid="+a+"]");c.toggleClass("selected");var d=this.selectedAmount;c.hasClass("selected")?(this.selectedItems.push(a),d+=parseFloat(b),this.selectedAmount=parseFloat(d.toFixed(2))):(c=this.selectedItems.indexOf(a),-1<c&&(this.selectedItems.splice(c,1),d-=parseFloat(b),this.selectedAmount=parseFloat(d.toFixed(2))));this.inventoryMakeOffer=!!this.selectedItems.length},
refreshInventory:function(){var a=this;a.inventories=[];a.curPage=0;a.noPrePage=!0;a.noNextPage=!0;a.selectedItems=[];a.selectedAmount=0;a.inventoryMakeOffer=!1;a.inventoryLoading=!0;a.inventoryLoaded=!1;$("#invRefresh").prop("disabled",!0);$.ajax({url:"/package-query/",type:"GET",success:function(b){0==b.code?(a.inventories=b.body.inventory.items,a.formatInventoryShow(a.curPage),a.inventoryLoading=!1,a.inventoryLoaded=!0,a.depositLoading=!1,a.initRefreshTimer()):(a.inventoryLoading=!1,a.inventoryLoaded=
!0,showWarning("Warning",b.message))}});$(".selected").removeClass("selected")},initRefreshTimer:function(){this.couldRefresh=!1;this.refreshTimer.stop();this.refreshTimer.start({countdown:!0,startValues:{seconds:10}})},prePage:function(){this.formatInventoryShow(this.curPage-1)&&--this.curPage},nextPage:function(){this.formatInventoryShow(this.curPage+1)&&(this.curPage+=1)},reformatInventories:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.amount=parseFloat(d.amount.toFixed(2));d.selected=
0<=this.selectedItems.indexOf(d.assetid);d.rarity_zh=rarityTrans(d.rarity);b.push(d)}return b},formatInventoryShow:function(a){if(0>a)return!1;var b=24*a;if(b>=this.inventories.length&&0!=this.inventories.length)return!1;this.noPrePage=0>=a;this.noNextPage=b+24>this.inventories.length;a=this.inventories.slice(b,b+24);this.inventoriesShow=this.reformatInventories(a);for(a=0;a<this.inventoriesShow.length;a++)-1<this.selectedItems.indexOf(this.inventoriesShow[a].assetid)&&$("div[data-itemid=sid]").addClass("selected");
return!0},deposit:function(a){var b=this;if(b.checkDeposits()){b.inventoryLoaded=!1;b.depositLoading=!0;a=[];for(var c=0;c<b.inventories.length;c++)-1<b.selectedItems.indexOf(b.inventories[c].assetid)&&a.push(b.inventories[c]);var d=b.extra.type;$.ajax({url:b.extra.depositUrl,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({team:b.selectedTeam,items:a,gid:b.gid}),success:function(a){0==a.code?(depositBus.$emit("deposited",{type:d,status:1,data:{},message:"In Queue"}),
b.checkTradeNo(a.body.uid,d)):201==a.code?(showWarning("Warning",a.message),b.depositFinished(!1)):showWarning("Warning","Deposit exception, please try another again.")}})}},checkTradeNo:function(a,b){var c=this;$.ajax({url:"/deposit-status/?uid="+a,type:"GET",success:function(d){0==d.code?c.depositFinished(!0):c.intervalID=setTimeout(function(){c.checkTradeNo(a,b)},1E3)}})},checkDeposits:function(){if(this.item.user.join_amount.min){if(this.selectedAmount<this.item.user.join_amount.min){var a="Minimum deposit amount is $"+
this.item.user.join_amount.min+", selected $"+this.selectedAmount;showWarning("Warning",a);return!1}if(this.selectedAmount>this.item.user.join_amount.max)return a="Maximum deposit amount is $"+this.item.user.join_amount.max+", selected $"+this.selectedAmount,showWarning("Warning",a),!1}else if(this.selectedAmount<this.item.settings.minamount)return a="Minimum deposit amount is $"+this.item.settings.minamount+", selected $"+this.selectedAmount,showWarning("Warning",a),!1;return this.selectedItems.length>
this.item.settings.maxitems?(a="Maximum deposit item count is "+this.item.settings.maxitems+", selected "+this.selectedItems.length,showWarning("Warning",a),!1):!0},depositFinished:function(a){this.intervalID&&clearTimeout(this.intervalID);$("#modal_close_button").simulate("click");a&&showNotice("Success","Deposit successfully")}}});
Vue.component("inventory",{template:"#item-template",delimiters:["^{","}"],props:["inventories"],methods:{clickItem:function(a){this.$emit("itemSelected",[a])},showName:function(a){this.$emit("show-name",[a])},hideName:function(a){this.$emit("hide-name",[a])}},updated:function(){$(".item-holder").perfectScrollbar()}});