var curDepositMap={},cfTotalAmount=0,cfTotalItems=0,cfTotalGames=0,viewConfilpModalData={id:"coinflipModal",isFull:!0,title:"Coinflip Round",content_com:"cf-view",text_save:"",text_close:"Okay"},joinInventoryModalData={id:"inventoryModal",isFull:!0,title:"Join Coinflip",content_com:"inv-deposit",modal_icon:"",text_save:"",text_close:"Okay"},spinArray="animation900 animation1080 animation1260 animation1440 animation1620 animation1800 animation1980 animation2160".split(" ");
function getSpin(a){return spinArray[2*Math.floor(Math.random()*spinArray.length/2)+a]}function init_cf_timer(a,b,f,e){$('*[data-id="'+a+'"] input[class="cfRoundKnob"]').val(b);a=new Timer;a.start({countdown:!0,startValues:{seconds:b}});a.addEventListener("secondsUpdated",function(a){"function"==typeof f&&f()});a.addEventListener("targetAchieved",function(a){"function"==typeof e&&e()});return a}
function init_team_selector(){$('div[class*="row-team"] img').click(function(){var a=this.dataset.team;$('div[class*="row-team"] img').removeClass("selected");$('div[class*="row-team"] img[data-team="'+a+'"]').addClass("selected")})}
function completeCoinflipData(a){a.lastSeconds=90;a.totalAmount=floatStrip(a.totalAmount,2);a.amount_o.min=floatStrip(a.amount_o.min,2);a.amount_o.max=floatStrip(a.amount_o.max,2);for(var b=0;b<a.deposit.length;b++)a.deposit[b].totalAmount=floatStrip(a.deposit[b].totalAmount,2);b=moment.unix(a.ts_get+1800);a.expires=b.format("a hh:mm");return a}
function updateJoinableGames(a){for(var b=0,f=0,e=0,d=0;d<a.length;d++)f+=a[d].totalAmount,e+=a[d].totalItems,0==a[d].joined.status&&(b+=1);cfTotalAmount=f;cfTotalItems=e;cfTotalGames=b}function updateCoinflipNumer(){animateNumber("#cfTotalAmount",cfTotalAmount,!0);animateNumber("#cfTotalItems",cfTotalItems,!1);animateNumber("#cfTotalGames",cfTotalGames,!1)}function updateOnlineUser(a){animateNumber(".users-online-value",a,!1)}Vue.component("game_row",{template:"#gamw_row"});
Vue.component("cf-view",{template:"#cf-view-template",delimiters:["^{","}"],props:["item","extra"],data:function(){return{timer:null,flip:!0,flipped:!1,endCounting:!1}},created:function(){this.extra.winnerData&&(this.flip=!1,this.flipped=!0);this.renderData()},mounted:function(){this.item.joined.status&&(this.item.full?this.extra.gameEnd&&!this.extra.winnerData&&this.renderEndCountdown():this.renderJoinCountdown())},updated:function(){var a=this;a.extra.joinCounting||a.item.full||!a.item.joined.status?
a.endCounting||!a.extra.gameEnd||a.extra.winnerData?a.extra.gameEnd&&a.extra.winnerData&&!a.flipped&&($("#coin").removeClass(),setTimeout(function(){$("#coin").addClass(getSpin(a.extra.winnerData.team))},100),setTimeout(function(){a.flipped=!0},3E3)):a.renderEndCountdown():a.renderJoinCountdown()},methods:{renderData:function(){},renderJoinCountdown:function(){init_cf_knob('div[id="cfRoundView"] input[class="cfRoundKnob"]',0,90,130,130,"#b22020","#f47d7d")},renderEndCountdown:function(){reset_cf_knob('div[id="cfRoundView"] input[class="cfRoundKnob"]',
0,10,130,130,"#2a6421","#5db14f");this.endCounting=!0},renderWinner:function(){}}});Vue.component("cf-get-started",{template:"#cf-getstarted-template",delimiters:["^{","}"],data:function(){return{minamount:1,maxitems:12}}});
$(function(){var a=$("#noSocket");a.show();var b=new ReconnectingWebSocket(("https:"==window.location.protocol?"wss":"ws")+"://"+window.location.host+"/ws/?page=coinflip");b.onopen=function(c){a.hide()};var f={id:"coinflipGetStartedModal",isFull:!0,title:"Get Started to play Coinflip",content_com:"cf-get-started",modal_icon:"",text_save:"",text_close:"Okay"},e={id:"historyModal",isFull:!0,title:"Coinflip history (last 7 days)",content_com:"cf-history",modal_icon:"",text_save:"",text_close:"Okay"},
d={user:{join_amount:{min:1,max:12E3},join_isteam:0,join_team:0},settings:{minamount:1,maxitems:12},gid:""},k={id:"inventoryModal",isFull:!0,title:"Create new Coinflip",content_com:"inv-deposit",modal_icon:"",text_save:"",text_close:"Okay"},l=new Vue({el:"#deposit_box",data:{steam_bot:!0}}),h=new Vue({el:"#cf_games",delimiters:["^{","}"],data:{items:[],toBeClear:[]},created:function(){var a=this;itemBus.$on("clear",function(c){a.removeItem(c)})},methods:{addItem:function(a){for(var c=null,b=0;b<this.items.length;b++)if(this.items[b].gid===
a.gid){c=this.items[b];break}if(c)Object.assign(c,a);else{c=-1;for(b=0;b<this.items.length;b++)if(a.deposit[0].amount>this.items[b].deposit[0].amount){c=b;break}0<=c?this.items.splice(c,0,a):this.items.push(a)}updateJoinableGames(this.items);updateCoinflipNumer();this.reformatSummary();$(".status-message").hide()},removeItem:function(a){for(this.toBeClear.push(a);;)if(10<this.items.length&&0<this.toBeClear.length){a=this.toBeClear.shift();for(var c=0;c<this.items.length;c++)if(this.items[c].gid===
a){this.items.splice(c,1);break}}else break;updateJoinableGames(this.items);updateCoinflipNumer();this.reformatSummary();0===this.items.length&&$(".status-message").show()},reformatSummary:function(){for(var a=0,b=0,f=$('meta[name="steamid"]').data("value"),e=0;e<this.items.length;e++)for(var d=this.items[e].deposit,g=0;g<d.length;g++)d[g].steamid===f&&(b+=parseFloat(d[g].totalAmount),a+=d[g].totalItems);animateNumber("#cfUserTotalItems",a,!1);animateNumber("#cfUserTotalAmount",b,!0)}}});$("#coinflipGetStarted").click(function(){modalArea.modalData=
f;modalArea.contentData=null;modalArea.extraData=null;Vue.nextTick(function(){$("#coinflipGetStartedModal").modal("show")})});$("#coinflipHistory").click(function(){modalArea.modalData=e;modalArea.contentData=null;modalArea.extraData={gameType:"coinflip",queryType:"myself",page:1};Vue.nextTick(function(){$("#historyModal").modal("show")})});$(".coinflipCreate").click(function(){modalArea.modalData=k;modalArea.contentData=d;modalArea.extraData={depositUrl:"/betting/coinflip/",type:0,showTeam:!0};Vue.nextTick(function(){$("#inventoryModal").modal("show")})});
b.onmessage=function(a){a=JSON.parse(a.data);if("message"===a[0])for(var b=0;b<a[1].length;b++)messageWrapper.addMessage({id:a[1][b].id,icon:a[1][b].steamer.icon,steamid:a[1][b].steamer.steamid,msg:a[1][b].message,name:a[1][b].steamer.name});else if("cf"===a[0])if("new"===a[1])a=fillCoinflipData(a[2],!1),h.addItem(a);else if("new_list"===a[1])for(a=a[2],b=0;b<a.length;b++)h.addItem(fillCoinflipData(a[b],!1));else"remove"===a[1]&&h.removeItem(a[2]);else"online"===a[0]?(b=$(".users-online-value"),b.empty(),
b.append(a[1])):"bot"===a[0]&&(l.steam_bot=a[1].status,updateBotStatus(a[1].status))};$("#pushChatMsg").click(function(a){a=$("#chat_msg");var c={message:a.val()};b.send(JSON.stringify(c));a.val("").focus();return!1})});