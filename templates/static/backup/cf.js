var curDepositMap={},cfTotalAmount=0,cfTotalItems=0,cfTotalGames=0,viewConfilpModalData={id:"coinflipModal",isFull:!0,title:"Coinflip Round",content_com:"cf-view",text_save:"",text_close:"Okay"},joinInventoryModalData={id:"inventoryModal",isFull:!0,title:"Join Coinflip",content_com:"inv-deposit",modal_icon:"",text_save:"",text_close:"Okay"},spinArray="animation900 animation1080 animation1260 animation1440 animation1620 animation1800 animation1980 animation2160".split(" ");
function getSpin(a){return spinArray[spinArray.length+a-2]}function init_cf_timer(a,b,d,e){$('*[data-id="'+a+'"] input[class="cfRoundKnob"]').val(b);a=new Timer;a.start({countdown:!0,startValues:{seconds:b}});a.addEventListener("secondsUpdated",function(a){"function"===typeof d&&d()});a.addEventListener("targetAchieved",function(a){"function"===typeof e&&e()});return a}
function init_team_selector(){$('div[class*="row-team"] img').click(function(){var a=this.dataset.team;$('div[class*="row-team"] img').removeClass("selected");$('div[class*="row-team"] img[data-team="'+a+'"]').addClass("selected")})}
function completeCoinflipData(a){a.lastSeconds=90;a.totalAmount=floatStrip(a.totalAmount,2);a.amount_o.min=floatStrip(a.amount_o.min,2);a.amount_o.max=floatStrip(a.amount_o.max,2);for(var b=0;b<a.deposit.length;b++)a.deposit[b].totalAmount=floatStrip(a.deposit[b].totalAmount,2);b=moment.unix(a.ts_get+1800);a.expires=b.format("a hh:mm");return a}
function updateJoinableGames(a){for(var b=0,d=0,e=0,f=0;f<a.length;f++)d+=a[f].totalAmount,e+=a[f].totalItems,0===a[f].joined.status&&(b+=1);cfTotalAmount=d;cfTotalItems=e;cfTotalGames=b}function updateCoinflipNumer(){animateNumber("#cfTotalAmount",cfTotalAmount,!0);animateNumber("#cfTotalItems",cfTotalItems,!1);animateNumber("#cfTotalGames",cfTotalGames,!1)}function updateOnlineUser(a){animateNumber(".users-online-value",a,!1)}Vue.component("game_row",{template:"#gamw_row"});
Vue.component("cf-view",{template:"#cf-view-template",delimiters:["^{","}"],props:["item","extra"],data:function(){return{timer:null,flip:!0,flipped:!1,endCounting:!1,zoomSize:100}},created:function(){this.extra.winner&&(this.flip=!1,this.flipped=!0);this.renderData()},mounted:function(){this.item.joined.status&&(this.item.full?this.extra.gameEnd&&!this.extra.winner&&this.renderEndCountdown():this.renderJoinCountdown())},updated:function(){var a=this;a.extra.joinCounting||a.item.full||!a.item.joined.status?
!a.endCounting&&a.extra.gameEnd?a.renderEndCountdown():a.extra.gameEnd&&a.extra.winner&&!a.flipped&&($("#coin").removeClass(),setTimeout(function(){$("#coin").addClass(getSpin(a.extra.winner.team))},100),$("#cfanimdone-wrapper").animate({zoom:"110%"},1750).animate({zoom:"100%"},2E3),setTimeout(function(){a.flipped=!0},3750)):a.renderJoinCountdown()},methods:{renderData:function(){},renderJoinCountdown:function(){init_cf_knob('div[id="cfRoundView"] input[class="cfRoundKnob"]',0,90,130,130,"#b22020",
"#f47d7d","#b22020")},renderEndCountdown:function(){reset_cf_knob('div[id="cfRoundView"] input[class="cfRoundKnob"]',0,10,130,130,"#2a6421","#5db14f","#2a6421");this.endCounting=!0},renderWinner:function(){}}});Vue.component("cf-get-started",{template:"#cf-getstarted-template",delimiters:["^{","}"],data:function(){return{minamount:1,maxitems:12}}});
$(function(){var a=$("#noSocket");a.show();var b=new ReconnectingWebSocket(("https:"===window.location.protocol?"wss":"ws")+"://"+window.location.host+"/ws/?page=coinflip");b.onopen=function(c){a.hide()};var d={id:"coinflipGetStartedModal",isFull:!0,title:"Get Started to play Coinflip",content_com:"cf-get-started",modal_icon:"",text_save:"",text_close:"Okay"},e={id:"historyModal",isFull:!0,title:"Coinflip history (last 7 days)",content_com:"cf-history",modal_icon:"",text_save:"",text_close:"Okay"},
f={user:{join_amount:{min:1,max:12E3},join_isteam:0,join_team:0},settings:{minamount:1,maxitems:12},gid:""},l={id:"inventoryModal",isFull:!0,title:"Create new Coinflip",content_com:"inv-deposit",modal_icon:"",text_save:"",text_close:"Okay"},m=new Vue({el:"#deposit_box",data:function(){return{steam_bot:!0}}}),k=new Vue({el:"#coinflip-wrapper",delimiters:["^{","}"],data:{games:[],totalAmount:0,totalGames:0,totalItems:0,joinGames:0,myDepositAmount:0,toBeClear:[]},created:function(){var c=this;itemBus.$on("clear",
function(a){c.clearGame(a)})},methods:{addGame:function(c){for(var a=null,b=0;b<this.games.length;b++)if(this.games[b].gid===c.gid){a=this.games[b];break}if(a)Object.assign(a,c);else{a=-1;for(b=0;b<this.games.length;b++)if(c.deposits[0].amount>this.games[b].deposits[0].amount){a=b;break}0<=a?this.games.splice(a,0,c):this.games.push(c);this.clearGameView()}this.updateSummary()},clearGame:function(a){this.toBeClear.push(a);this.clearGameView();this.updateSummary()},clearGameDirect:function(a){for(var c=
0;c<this.games.length;c++)if(this.games[c].gid===a){this.games.splice(c,1);break}this.updateSummary()},clearGameView:function(){for(;;)if(10<this.games.length&&0<this.toBeClear.length)for(var a=this.toBeClear.shift(),b=0;b<this.games.length;b++){if(this.games[b].gid===a){this.games.splice(b,1);break}}else break},updateSummary:function(){for(var a=$("meta[name=steamid]").data("value"),b=0,d=0,e=0,f=0,g=0;g<this.games.length;g++){b+=this.games[g].total_amount;e+=this.games[g].totalItems;for(var h=0;h<
this.games[g].deposits.length;h++)a===this.games[g].deposits[h].steamer.steamid&&(d+=this.games[g].deposits[h].amount);3>this.games[g].status&&(f+=1)}this.totalAmount=parseFloat(b.toFixed(2));this.joinGames=f;this.totalItems=e;this.totalGames=this.games.length;this.myDepositAmount=parseFloat(d.toFixed(2))}}});$("#coinflipGetStarted").click(function(){modalArea.modalData=d;modalArea.contentData=null;modalArea.extraData=null;Vue.nextTick(function(){$("#coinflipGetStartedModal").modal("show")})});$("#coinflipHistory").click(function(){modalArea.modalData=
e;modalArea.contentData=null;modalArea.extraData={gameType:"coinflip",queryType:"myself",page:1};Vue.nextTick(function(){$("#historyModal").modal("show")})});$(".coinflipCreate").click(function(){modalArea.modalData=l;modalArea.contentData=f;modalArea.extraData={depositUrl:"/api/coinflip/join/",type:0,showTeam:!0};Vue.nextTick(function(){$("#inventoryModal").modal("show")})});b.onmessage=function(a){a=JSON.parse(a.data);if("message"===a[0])for(var b=0;b<a[1].length;b++)messageWrapper.addMessage({id:a[1][b].id,
icon:a[1][b].steamer.avatar,steamid:a[1][b].steamer.steamid,msg:a[1][b].message,name:a[1][b].steamer.personaname});else if("cf"===a[0])if("new"===a[1])a=fillCoinflipData(a[2],!1),k.addGame(a);else if("new_list"===a[1])for(a=a[2],b=0;b<a.length;b++)k.addGame(fillCoinflipData(a[b],!1));else"remove"===a[1]&&k.clearGameDirect(a[2]);else"online"===a[0]?(b=$(".users-online-value"),b.empty(),b.append(a[1])):"bot"===a[0]&&(m.steam_bot=a[1].status,updateBotStatus(a[1].status))};$("#pushChatMsg").click(function(a){a=
$("#chat_msg");var c={message:a.val()};b.send(JSON.stringify(c));a.val("").focus();return!1});$("#chat_msg").keyup(function(a){if(13===a.keyCode){a=$("#chat_msg");var c={message:a.val()};b.send(JSON.stringify(c));a.val("").focus()}})});