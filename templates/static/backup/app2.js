var messageWrapper=null,siteSmileys=[[":ez:",'<img src="/static/img/chat/ez.png" />'],[":facepalm:",'<img src="/static/img/chat/facepalm.png" />'],[":fail:",'<img src="/static/img/chat/fail.png" />'],[":gl:",'<img src="/static/img/chat/gl.png" />'],[":illuminati:",'<img src="/static/img/chat/illuminati.png" />'],[":kappa:",'<img src="/static/img/chat/kappa.png" />'],[":luck:",'<img src="/static/img/chat/luck.png" />'],[":pepe:",'<img src="/static/img/chat/pepe.png" />'],[":rip:",'<img src="/static/img/chat/rip.png" />'],
[":salty:",'<img src="/static/img/chat/salty.png" />'],[":sniped:",'<img src="/static/img/chat/sniped.png" />']],chatRulesModalData={id:"chatRulesModal",isFull:!1,title:"Chat Rules",content_com:"chat-rules",modal_icon:"handel-icon",text_save:"",text_close:"Okay"};function reformatSmiley(a){for(var b=0;b<siteSmileys.length;b++)a=a.replace(siteSmileys[b][0],siteSmileys[b][1]);return a}Vue.component("chat-rules",{template:"#chat-rules-template"});
Vue.component("chat-item",{template:"#chat-template",delimiters:["^{","}"],props:["item"],mounted:function(){var a=this.$refs.chat_msg_content;a.innerHTML=reformatSmiley(a.innerText)}});Vue.component("handel-icon",{template:"#handel-icon-template"});
$(function(){messageWrapper=new Vue({el:"#messages-wrapper",delimiters:["^{","}"],data:{items:[]},methods:{addMessage:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].id===a.id)return;12<=this.items.length&&this.items.shift();this.items.push(a);Vue.nextTick(function(){$("#messages-wrapper").scrollTop(830).perfectScrollbar("update")})}}});$("#mChatRules").click(function(){modalArea.modalData=chatRulesModalData;Vue.nextTick(function(){$("#chatRulesModal").modal("show")})});$(".chat-smile").click(function(){var a=
$(this).data("code"),b=$("#chat_msg");b.val(b.val()+a)});$("#messages-wrapper").perfectScrollbar()});var depositBus=new Vue;
Vue.component("inv-deposit",{template:"#inv-deposit-template",delimiters:["^{","}"],props:["item","extra"],data:function(){return{selectedTeam:this.item.user.join_team?this.item.user.join_team:0,inventories:[],inventoriesShow:[],selectedItems:[],selectedAmount:0,couldRefresh:!0,refreshTimer:null,gid:this.item.gid,inventoryLoading:!0,inventoryLoaded:!1,inventoryMakeOffer:!1,depositLoading:!1,intervalID:null,tradeNo:null,securityCode:null,showTeam:this.extra.showTeam,last_query_assetid:"",next_query_assetid:"",
curPage:0,noPrePage:!0,noNextPage:!0}},created:function(){var a=this;a.refreshTimer=new Timer;a.refreshTimer.addEventListener("secondsUpdated",function(b){b=a.refreshTimer.getTimeValues();b=60*b.minutes+b.seconds;$("#invTimer").text(b)});a.refreshTimer.addEventListener("targetAchieved",function(b){a.couldRefresh=!0;$("#invRefresh").prop("disabled",!1)})},mounted:function(){this.initShow();this.refreshInventory()},destroyed:function(){this.refreshTimer.stop();this.intervalID&&clearTimeout(this.intervalID)},
methods:{initShow:function(){this.tradeNo=null;this.depositLoading=this.inventoryLoaded=!1;this.inventoryLoading=!0;this.inventoryMakeOffer=!1;this.intervalID=null},selectTeam:function(a){a=a.currentTarget.dataset.team;this.selectedTeam=parseInt(a);$('div[class*="row-team"] img').removeClass("selected");$('div[class*="row-team"] img[data-team="'+a+'"]').addClass("selected")},selectItem:function(a){var b=this.selectedAmount;if(a.selected)this.selectedItems.push(a.assetid),b+=parseFloat(a.amount),this.selectedAmount=
parseFloat(b.toFixed(2));else{var c=this.selectedItems.indexOf(a.assetid);-1<c&&(this.selectedItems.splice(c,1),b-=a.amount,this.selectedAmount=parseFloat(b.toFixed(2)))}this.inventoryMakeOffer=!!this.selectedItems.length},refreshInventory:function(){var a=this;a.inventories=[];a.curPage=0;a.noPrePage=!0;a.noNextPage=!0;a.selectedItems=[];a.selectedAmount=0;a.inventoryMakeOffer=!1;a.inventoryLoading=!0;a.inventoryLoaded=!1;$("#invRefresh").prop("disabled",!0);axios.get("/api/user/inventory/?s_assetid="+
a.next_query_assetid).then(function(b){b=b.data;0===b.code?(b=b.body.inventory,a.inventories=_.map(b.items,function(a){return _.assign({selected:!1},a)}),a.formatInventoryShow(a.curPage),a.inventoryLoading=!1,a.inventoryLoaded=!0,a.depositLoading=!1,a.initRefreshTimer(),a.last_query_assetid=a.next_query_assetid,a.next_query_assetid=0<b.items.length?b.items[b.items.length-1].assetid:null):(a.inventoryLoading=!1,a.inventoryLoaded=!0,showWarning("Warning",b.message))})},initRefreshTimer:function(){this.couldRefresh=
!1;this.refreshTimer.start({countdown:!0,startValues:{seconds:45}})},prePage:function(){this.formatInventoryShow(this.curPage-1)&&--this.curPage},nextPage:function(){this.formatInventoryShow(this.curPage+1)&&(this.curPage+=1)},reformatInventories:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.amount=parseFloat(d.amount.toFixed(2));b.push(d)}return b},formatInventoryShow:function(a){if(0>a)return!1;var b=24*a;if(b>=this.inventories.length)return!1;this.noPrePage=0>=a;this.noNextPage=b+24>
this.inventories.length;a=this.inventories.slice(b,b+24);this.inventoriesShow=this.reformatInventories(a);return!0},deposit:function(a){var b=this;if(b.checkDeposits()){b.inventoryLoaded=!1;b.depositLoading=!0;var c=b.extra.type;axios.post(b.extra.depositUrl,{team:b.selectedTeam,items:b.selectedItems,gid:b.gid}).then(function(a){a=a.data;0===a.code?(depositBus.$emit("deposited",{type:c,status:1,data:{},message:"In Queue"}),b.checkTradeNo(a.body.uid,c)):(201===a.code?showWarning("Warning",a.message):
showWarning("Warning","Deposit exception, please try another again."),b.depositFinished(!1))})}},checkTradeNo:function(a,b){var c=this;axios.get("/api/store/status/?uid="+a).then(function(d){d=d.data;0===d.code&&(2===d.body.status?(showWarning("Error","Failed to send trade url on steam. \nPlease try again later."),c.depositFinished(!1)):(d.body.tradeNo&&!c.tradeNo&&(c.tradeNo=d.body.tradeNo,c.securityCode=d.body.securityCode,depositBus.$emit("deposited",{type:b,status:2,data:{uid:a,securityCode:c.securityCode,
tradeNo:c.tradeNo},message:"In Queue"})),1===d.body.status?(depositBus.$emit("deposited",{type:b,status:3,data:{uid:a,securityCode:c.securityCode,tradeNo:c.tradeNo},message:"Joined"}),c.depositFinished(!0)):c.intervalID=setTimeout(function(){c.checkTradeNo(a,b)},1E3)))})},checkDeposits:function(){if(this.item.user.join_amount.min){if(this.selectedAmount<this.item.user.join_amount.min){var a="Minimum deposit amount is $"+this.item.user.join_amount.min+", selected $"+this.selectedAmount;showWarning("Warning",
a);return!1}if(this.selectedAmount>this.item.user.join_amount.max)return a="Maximum deposit amount is $"+this.item.user.join_amount.max+", selected $"+this.selectedAmount,showWarning("Warning",a),!1}else if(this.selectedAmount<this.item.settings.minamount)return a="Minimum deposit amount is $"+this.item.settings.minamount+", selected $"+this.selectedAmount,showWarning("Warning",a),!1;return this.selectedItems.length>this.item.settings.maxitems?(a="Maximum deposit item count is "+this.item.settings.maxitems+
", selected "+this.selectedItems.length,showWarning("Warning",a),!1):!0},depositFinished:function(a){this.intervalID&&clearTimeout(this.intervalID);$("#modal_close_button").simulate("click");a&&showNotice("Success","Deposit successfully")}}});Vue.component("inventory",{template:"#inventory-template",delimiters:["^{","}"],props:["inventories"],methods:{selectItem:function(a){a.selected=!a.selected;this.$emit("selected",a)}},updated:function(){$(".item-holder").perfectScrollbar()}});