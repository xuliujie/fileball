var colorRange=["#c7413b"],curDepositItems=0,vars={freeChartColor:"#2d3538",chartBorder:"#2d3538",chartTooltipBg:"rgba(0,0,0,0.8)",maxCount:50},jackpotWinnerModal={id:"jackpotWinnerModal",isFull:!1,title:"Congratulations!",content_com:"jackpot-winner",modal_icon:"jackpot-winner-icon",text_save:"",text_close:"Okay"},currentCounter={gid:null,timer:new Timer};
currentCounter.timer.addEventListener("secondsUpdated",function(c){c=currentCounter.timer.getTimeValues();$("#least_minutes").text(c.minutes);$("#least_seconds").text(c.seconds)});currentCounter.timer.addEventListener("targetAchieved",function(c){});function toggleItems(c){$(c).parents(".table-bet").next().toggle("fast")}function formatShowItems(c){for(var d=[],e=0;e<c.deposits.length;e++)d=d.concat(c.deposits[e].items);d=d.sort(compareItem);8<=d.length&&(d=d.slice(0,8));return d}
function formatMySummary(c){for(var d=$('meta[name="steamid"]').data("value"),e=0,h=0,g=0;g<c.deposits.length;g++){var f=c.deposits[g];f.steamer.steamid===d&&(e+=f.items.length,h+=f.amount)}d=0;0<c.total_amount&&($("#my_jackpot_joining").text("Joining"),d=parseFloat((100*h/c.total_amount).toFixed(2)));curDepositItems=e;animateNumber("#my_jackpot_amount",e,!1);animateNumber("#my_jackpot_percent",d,!0)}
function setupCountdown(c){if(currentCounter.gid!==c.uid&&c.run_ts){Date.now();var d=c.least_sec;0<d&&currentCounter.timer.start({countdown:!0,startValues:{seconds:d}});currentCounter.gid=c.uid}}function getNextColor(c){return colorRange[c%colorRange.length]}Vue.component("steamer",{template:"#steamer_template",delimiters:["^{","}"],props:["item"]});Vue.component("jackpot-winner",{template:"#jackpot_winner_template",delimiters:["^{","}"],props:["item"]});Vue.component("jackpot-winner-icon",{template:"#jackpot_winner_icon_template"});
Vue.component("scroll-sel",{template:"#scroll_template",delimiters:["^{","}"],props:["deposit"],created:function(){},mounted:function(){var c=this,d=$("#"+c.deposit.uid+" .slidee");d.css({width:80*c.deposit.joiners.length});var e="translate("+(240-(80*c.deposit.win_index+(1+Math.floor(79*Math.random()))))+"px, 0)";setTimeout(function(){$("#rolling_audio")[0].play();d.css({"-webkit-transform":e})},1E3);setTimeout(function(){c.$emit("winnerRolled")},8E3)},updated:function(){}});
Vue.component("jackpot_detail",{template:"#jackpot_detail_template",delimiters:["^{","}"],props:["item","index"],components:{panel:VueStrap.panel},data:function(){return{rolled:!!this.item.winner}},methods:{onWinnerRolled:function(){this.deposit=null;this.rolled=!0;var c=$('meta[name="steamid"]').data("value");this.item.winner.steamer.steamid===c&&this.showJackpotWinner(this.item.hash)},showJackpotWinner:function(){modalArea.modalData=jackpotWinnerModal;modalArea.contentData=this.item;Vue.nextTick(function(){$("#jackpotWinnerModal").modal("show")})}}});
$(function(){var c=$("#noSocket");c.show();var d=new ReconnectingWebSocket(("https:"===window.location.protocol?"wss":"ws")+"://"+window.location.host+"/ws/?page=jackpot");d.onopen=function(a){c.hide()};var e={user:{join_amount:{min:1,max:12E3},join_isteam:0,join_team:0},settings:{minamount:1,maxitems:12},gid:""},h={id:"inventoryModal",isFull:!0,title:"Join Jackpot",content_com:"inv-deposit",modal_icon:"",text_save:"",text_close:"Okay"},g=new Vue({el:"#jackpot_summary",delimiters:["^{","}"],data:{currentGame:null,
steam_bot:!0,chart:null,depositStatus:"Not In",joiners:[],items:[]},created:function(){var a=this;depositBus.$on("deposited",function(b){1===b.type&&(a.depositStatus=b.message)})},mounted:function(){this.initChart();resizeKnob()},computed:{totalCount:function(){if(this.currentGame){for(var a=0,b=0;b<this.currentGame.deposits.length;b++)a+=this.currentGame.deposits[b].items.length;return a}return 0}},watch:{currentGame:function(a,b){this.renderChart()}},methods:{initChart:function(){var a=this;if(!a.chart){var b=
$("#jackpot_chart");a.chart=new Chart(b,{type:"doughnut",data:{datasets:[{data:[1E3],backgroundColor:[vars.freeChartColor],hoverBackgroundColor:[]}],labels:["Free"]},options:{tooltips:{callbacks:{label:function(b,c){var d=b.index;if(a.currentGame&&a.currentGame.deposits[d]){var e=a.currentGame.deposits[d].steamer.personaname;16<e.length&&(e=e.substr(0,16));return e+" placed $"+a.currentGame.deposits[d].amount}return"-"}},bodyFontSize:10},elements:{arc:{backgroundColor:vars.chartBorder,borderColor:vars.chartBorder}},
title:{display:!1},legend:{display:!1},animation:{animateScale:!0},cutoutPercentage:60,animateScale:!0,responsive:!0}})}},resetKnob:function(){},renderChart:function(){for(var a=[{data:[],backgroundColor:[],hoverBackgroundColor:[]}],b=[],c=this.currentGame.total_items,d=this.currentGame.total_amount,e=0;e<this.currentGame.deposits.length;e++){var f=this.currentGame.deposits[e];c+=f.items.length;a[0].data.push(f.amount/d*c);a[0].backgroundColor.push(f.color);b.push(f.steamer.personaname)}c<vars.maxCount&&
(a[0].data.push(vars.maxCount-c),a[0].backgroundColor.push(vars.freeChartColor),b.push("Free"));this.chart.data.datasets=a;this.chart.data.lables=b;this.chart.update()},updateJackpotKnobs:function(a){this.currentGame=a}}}),f=new Vue({el:"#winner_wrapper",delimiters:["^{","}"],data:{checked:!1,histories:[]},created:function(){},mounted:function(){},updated:function(){}});d.onmessage=function(a){a=JSON.parse(a.data);if("message"===a[0])for(var b=0;b<a[1].length;b++)messageWrapper.addMessage({id:a[1][b].id,
icon:a[1][b].steamer.avatar,steamid:a[1][b].steamer.steamid,msg:a[1][b].message,name:a[1][b].steamer.personaname});else"jk"===a[0]?(b=null,"new"===a[1]?(b=a[2],b.total_amount=parseFloat(b.total_amount.toFixed(2)),g.resetKnob(),8<=f.histories.length&&f.histories.pop(),f.histories.unshift(b),$("#my_jackpot_joining").text("Not in")):"update"===a[1]?(b=a[2],b.total_amount=parseFloat(b.total_amount.toFixed(2)),f.histories.splice(0,1,b)):"history"===a[1]&&(b=a[2][0],f.histories=a[2]),b&&(g.items=formatShowItems(b),
animateNumber("#deposit_item_count",b.total_items,!1),animateNumber("#jackpotTotalAmount",b.total_amount,!0),g.updateJackpotKnobs(b),formatMySummary(b),setupCountdown(b))):"online"===a[0]?(b=$(".users-online-value"),b.empty(),b.append(a[1])):"bot"===a[0]&&(g.steam_bot=a[1].status,updateBotStatus(a[1].status))};$("#pushChatMsg").click(function(a){a=$("#chat_msg");var b={message:a.val()};d.send(JSON.stringify(b));a.val("").focus();return!1});$("#chat_msg").keyup(function(a){if(13===a.keyCode){a=$("#chat_msg");
var b={message:a.val()};d.send(JSON.stringify(b));a.val("").focus()}});$("#jackpot_deposit_button").click(function(){modalArea.modalData=h;e.settings.maxitems=12-curDepositItems;modalArea.contentData=e;modalArea.extraData={depositUrl:"/api/jackpot/join/",type:1,showTeam:!1};Vue.nextTick(function(){$("#inventoryModal").modal("show")})});setTimeout(function(){},4E3)});